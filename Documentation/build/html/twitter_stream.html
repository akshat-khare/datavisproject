<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Read data from Twitter API &mdash; Twitter Analytics 0.1 documentation</title>
  

  
  

  

  

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/jquery-ui/jquery-ui.min.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/css/t3more.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Twitter Analytics 0.1 documentation" href="#"/>
        <link rel="next" title="Putting tweets to Kafka" href="kafka.html"/>
        <link rel="prev" title="Introduction to twitter analytics system" href="introduction.html"/> 
  <script src="_static/js/modernizr.min.js"></script>
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        <ul class="sidebartop">

          <li class="docsite">
            <a href="https://docs.typo3.org"><img src="_static/img/typo3-documentation.png" class="logo" /></a>
          </li>

          <li class="project">
            <a href="index.html">
              Twitter Analytics<br>0.1</a>
          </li><li class="nolink search">
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search this project" id="searchinput" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div></li>

        </ul>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to twitter analytics system</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#major-parts-of-the-system">Major parts of the system</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Read data from Twitter API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#user-timeline-api">User Timeline API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stream-sample-api">Stream Sample API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#user-timeline-api-code-documentation">User Timeline API Code Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stream-sample-api-code-documentation">Stream Sample API Code Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="kafka.html">Putting tweets to Kafka</a><ul>
<li class="toctree-l2"><a class="reference internal" href="kafka.html#kafka-tweet-producer-documentation">Kafka Tweet Producer Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="neo4j_data_ingestion.html">Ingesting data into Neo4j</a><ul>
<li class="toctree-l2"><a class="reference internal" href="neo4j_data_ingestion.html#data-stored-in-neo4j">Data stored in neo4j</a><ul>
<li class="toctree-l3"><a class="reference internal" href="neo4j_data_ingestion.html#user-network">User network</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_data_ingestion.html#tweet-network">Tweet network</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_data_ingestion.html#indexing-network">Indexing network</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="neo4j_data_ingestion.html#ingesting-the-data-into-neo4j-logic">Ingesting the data into neo4j : Logic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="neo4j_data_ingestion.html#improving-ingestion-rate-using-transaction">Improving ingestion rate using transaction</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_data_ingestion.html#indexing">Indexing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="neo4j_data_ingestion.html#running-the-ingestion-script">Running the ingestion script</a><ul>
<li class="toctree-l3"><a class="reference internal" href="neo4j_data_ingestion.html#streaming-data">Streaming data</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_data_ingestion.html#user-timeline-data">User Timeline data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="neo4j_data_ingestion.html#neo4j-ingestion-rates">Neo4j Ingestion Rates</a></li>
<li class="toctree-l2"><a class="reference internal" href="neo4j_data_ingestion.html#code-documentation-for-neo4j-data-ingestion">Code Documentation for Neo4j data ingestion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mongoDB_data_ingestion.html">Ingesting data into MongoDB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_data_ingestion.html#why-store-in-mongodb">Why store in MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_data_ingestion.html#data-format-in-mongodb">Data Format in mongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_data_ingestion.html#mongodb-v-s-neo4j">mongoDB v/s neo4j</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_data_ingestion.html#ingesting-the-data-into-mongodb-logic">Ingesting the data into mongoDB : Logic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mongoDB_data_ingestion.html#improving-ingestion-rate-using-transactions">Improving ingestion rate using transactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="mongoDB_data_ingestion.html#improving-ingestion-rate-using-parallel-multiple-process">Improving ingestion rate using parallel multiple process</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_data_ingestion.html#ingesting-the-data-into-mongodb-practical-side">Ingesting the data into mongoDB : Practical side</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_data_ingestion.html#mongodb-ingestion-rates">MongoDB Ingestion Rates</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_data_ingestion.html#module-ingest_raw">Code Documentation for mongoDB ingestion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="neo4j_query_generation.html">Neo4j: API to generate cypher queries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="neo4j_query_generation.html#template-of-a-general-query">Template of a general query</a><ul>
<li class="toctree-l3"><a class="reference internal" href="neo4j_query_generation.html#basic-abstraction">Basic Abstraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_query_generation.html#naming-entities">Naming entities</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_query_generation.html#variable-attributes">Variable attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_query_generation.html#returns">Returns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="neo4j_query_generation.html#creating-a-custom-query-through-dashboard-api-behind-the-scenes">Creating a custom query through dashboard API : Behind the scenes</a></li>
<li class="toctree-l2"><a class="reference internal" href="neo4j_query_generation.html#code-documentation-for-neo4j-query-generation">Code Documentation for Neo4j query generation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mongoDB_query_generation.html">Generating queries in mongoDB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_query_generation.html#generic-api-for-mongodb-idea">Generic API for mongoDB : Idea</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mongoDB_query_generation.html#mongodb-query-execution-code-documentation">MongoDB query execution code documentation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="postprocessing.html">About Post processing functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="postprocessing.html#need-of-post-processing-function">Need of post processing function</a></li>
<li class="toctree-l2"><a class="reference internal" href="postprocessing.html#format-of-post-processing-functions">Format of post processing functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="postprocessing.html#executing-post-processing-function">Executing post processing function</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dag.html">Composing multiple queries : DAG</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dag.html#basic-terminology">Basic terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag.html#idea-behind-a-dag">Idea behind a DAG</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag.html#building-a-dag-from-queries">Building a DAG from queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag.html#dag-in-airflow">DAG in airflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag.html#creating-custom-metric">Creating custom metric</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag.html#code-documentation-for-dag-abstraction">Code Documentation for DAG abstraction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="flink.html">Generating alerts using Apache Flink</a><ul>
<li class="toctree-l2"><a class="reference internal" href="flink.html#alert-specification-abstraction">Alert Specification Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="flink.html#back-end-process">Back-end process</a></li>
<li class="toctree-l2"><a class="reference internal" href="flink.html#example-finding-viral-hashtags">Example - Finding viral hashtags</a></li>
<li class="toctree-l2"><a class="reference internal" href="flink.html#flink-code-generator-documentation">Flink Code Generator Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="flink.html#flink-api-documentation">Flink API Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="flink.html#flink-alerts-consumer">Flink Alerts Consumer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="benchmarking.html">Benchmarking the query answering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="benchmarking.html#neo4j-queries">Neo4j queries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="benchmarking.html#simple-queries">Simple Queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="benchmarking.html#complex-queries">Complex Queries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="benchmarking.html#mongodb-queries">MongoDB queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="benchmarking.html#code-documentation-for-benchmarking">Code Documentation for benchmarking</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dashboard_website.html">Dashboard Website</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dashboard_website.html#major-parts-of-the-dashboard-website">Major parts of the dashboard website</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#hashtags">Hashtags</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#mentions">Mentions</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#urls">URLs</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#alerts">Alerts</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#dag">DAG</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dashboard_website.html#use-cases">Use Cases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#viewing-top-10-popular-hashtags">Viewing top 10 popular hashtags</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#viewing-usage-history-of-hashtag">Viewing usage history of  hashtag</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#viewing-sentiment-history-of-hashtag">Viewing sentiment history of  hashtag</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#creating-a-mongodb-query">Creating a mongoDB query</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#creating-neo4j-queries">Creating neo4j queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#create-post-processing-function">Create Post processing function</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#view-queries">View Queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#create-dag">Create DAG</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#view-dags">View DAGs</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#create-custom-metric">Create Custom metric</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#create-alert">Create Alert</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#view-alerts">View Alerts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Getting the system running</a><ul>
<li class="toctree-l2"><a class="reference internal" href="running.html#setting-up-the-environment">Setting up the environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#running-the-dashboard">Running the dashboard</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Twitter Analytics</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    <li>Read data from Twitter API</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/twitter_stream.rst.txt" rel="nofollow">
                <span class="fa fa-binoculars"></span>&#32;View page source
            </a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody" class="toBeIndexed">
            
  <div class="section" id="read-data-from-twitter-api">
<h1>Read data from Twitter API<a class="headerlink" href="#read-data-from-twitter-api" title="Permalink to this headline">¶</a></h1>
<p>There are a couple of ways to read data from the Twitter APIs:</p>
<blockquote>
<div><ul class="simple">
<li>User Timeline: Fetching the timeline (all tweets) of a given user till that time. The Twitter API end-point for this is GET statuses/user_timeline</li>
<li>Stream Sample: Streaming a random 1% sample of all live tweets. The Twitter API end-point for the same is GET statuses/sample.</li>
</ul>
</div></blockquote>
<p>If you wish to gather data of a specific set of users, then you have to use the User Timeline API, otherwise for live stream use the Stream Sample API. We experimented with both the techniques.</p>
<p>To have access to Twitter APIs, you need to create an account on apps.twitter.com to use their OAuth based authorization system. Details for the same can be found on this <a class="reference external" href="https://developer.twitter.com/en/docs/basics/getting-started">link</a>. This will generate a unique set of Access Token, Access Secret, Consumer Key and Consumer Secret for you, which need to be used while making the API calls. We made use of Python Twitter Tools library which exposes Python functions which make the API call for us based on the parameters.</p>
<div class="section" id="user-timeline-api">
<h2>User Timeline API<a class="headerlink" href="#user-timeline-api" title="Permalink to this headline">¶</a></h2>
<p>For a given user, you can find the following:</p>
<blockquote>
<div><ul class="simple">
<li>User information: Eg. no. of tweets, no. of followers, no. of friends, no. of likes, location etc.</li>
<li>All tweets by the user till that point of time.</li>
<li>All friends and followers of that user at that point of time.</li>
</ul>
</div></blockquote>
<p>Rate Limit: Each API endpoint has its own rate limit which limits the number of calls you can make to Twitter for that API in a period of 15 minutes. The rate limit can be checked <a class="reference external" href="https://developer.twitter.com/en/docs/basics/rate-limits">here</a>. You need to adhere to these rate limits, else your account may be blacklisted. We do this in our application as follows: For each API endpoint, we maintain an array which keeps the history of number of calls made in each minute in the past 15 minutes. For each request of an API call, we check the array, delete entries older than 15 minutes and keep checking the total number of requests in past 15 minutes until it is less than the rate limit threshold. Only then we make the API call.</p>
<p>Incremental data: You may need to periodically make calls to the Twitter API to get the new tweets that were tweeted by the users since the last time you called the API. Twitter provides a mechanism to do this by using the parameter “since_id” in the statuses/user_timeline API call. The API returns tweets that have an id &gt; since_id. Thus you can keep store of the maximum tweet id that you have seen for each user and make the next API call using that as the value of since_id to get the new tweets.</p>
<p>Refer to the file: ‘Read Twitter Stream/main.py’ for the code. The main function expects a file containing a list of user screen names separated by new lines. It generates a folder the data as mentioned in the main function. Each time you run the file, it accumulates the new data in this directory.</p>
</div>
<div class="section" id="stream-sample-api">
<h2>Stream Sample API<a class="headerlink" href="#stream-sample-api" title="Permalink to this headline">¶</a></h2>
<p>The end-point GET statuses/sample is free, however it returns only about 1% of the actual stream. You can buy the enterprise version called Decahose to have access to 10% of the stream.</p>
<p>Batch writes: In order to speed up the process of persisting the tweets from memory to disk, we make use of batch writes. Our streaming application will keep buffering tweets till the batch size is reached. Once the the batch size is reached, it flushes all the buffered tweets to the current tweet file. Additionally, it keeps track of number of tweets written to the current tweet file and once it exceeds a threshold, it starts with a new file and starts flushing to it. This will prevent a single file from becoming too big in size.</p>
<p>Refer to the file ‘Read Twitter Stream/streaming.py’ for the code. The code will write the data in the same directory, flushing the data periodically to a file. After a threshold number of tweets have been written to the current output file, it generates a new file and starts flushing the tweets to it. This will prevent a single file from becoming too big in size.</p>
</div>
<div class="section" id="user-timeline-api-code-documentation">
<h2>User Timeline API Code Documentation<a class="headerlink" href="#user-timeline-api-code-documentation" title="Permalink to this headline">¶</a></h2>
<p>Here we provide a documentation of the code.</p>
<span class="target" id="module-userstimeline"></span><p>Module to fetch data of a specified list of users. Data includes user’s profile information, all tweets on
user’s timeline till now and list of ids of user’s followers and friends.</p>
<p>In the main function, configure the path of the directory of the data folder to be created and the path of a file containing
a list of user screen names separated by new lines. It generates a folder for the data as specified in the main function.
Each time you run the file, it accumulates the new data in this directory.</p>
<p>Create a file named SECRETS which contains your Twitter OAuth related keys in the following order, separated by new lines:
&lt;ACCESS_TOKEN&gt;
&lt;ACCESS_SECRET&gt;
&lt;CONSUMER_KEY&gt;
&lt;CONSUMER_SECRET&gt;</p>
<p><strong>Running the code</strong>:</p>
<blockquote>
<div><blockquote>
<div><ul class="simple">
<li>First ensure Python Twitter Tools is installed. (<a class="reference external" href="https://github.com/sixohsix/twitter">https://github.com/sixohsix/twitter</a>)</li>
<li>Before running, you may want to change the name of the file (containing the user screen names)
in the main function. That file should contain one screen name in each line.</li>
</ul>
</div></blockquote>
<p><em>Command to run</em>:
<code class="docutils literal"><span class="pre">python</span> <span class="pre">main.py</span></code></p>
</div></blockquote>
<dl class="class">
<dt id="userstimeline.DateTimeEncoder">
<em class="property">class </em><code class="descclassname">userstimeline.</code><code class="descname">DateTimeEncoder</code><span class="sig-paren">(</span><em>*</em>, <em>skipkeys=False</em>, <em>ensure_ascii=True</em>, <em>check_circular=True</em>, <em>allow_nan=True</em>, <em>sort_keys=False</em>, <em>indent=None</em>, <em>separators=None</em>, <em>default=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#DateTimeEncoder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.DateTimeEncoder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">json.encoder.JSONEncoder</span></code></p>
<dl class="method">
<dt id="userstimeline.DateTimeEncoder.default">
<code class="descname">default</code><span class="sig-paren">(</span><em>o</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#DateTimeEncoder.default"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.DateTimeEncoder.default" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="userstimeline.DateTimeEncoder.encode">
<code class="descname">encode</code><span class="sig-paren">(</span><em>o</em><span class="sig-paren">)</span><a class="headerlink" href="#userstimeline.DateTimeEncoder.encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a JSON string representation of a Python data structure.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">json.encoder</span> <span class="k">import</span> <span class="n">JSONEncoder</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">JSONEncoder</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">({</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">]})</span>
<span class="go">&#39;{&quot;foo&quot;: [&quot;bar&quot;, &quot;baz&quot;]}&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="userstimeline.DateTimeEncoder.item_separator">
<code class="descname">item_separator</code><em class="property"> = ', '</em><a class="headerlink" href="#userstimeline.DateTimeEncoder.item_separator" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="userstimeline.DateTimeEncoder.iterencode">
<code class="descname">iterencode</code><span class="sig-paren">(</span><em>o</em>, <em>_one_shot=False</em><span class="sig-paren">)</span><a class="headerlink" href="#userstimeline.DateTimeEncoder.iterencode" title="Permalink to this definition">¶</a></dt>
<dd><p>Encode the given object and yield each string
representation as available.</p>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">JSONEncoder</span><span class="p">()</span><span class="o">.</span><span class="n">iterencode</span><span class="p">(</span><span class="n">bigobject</span><span class="p">):</span>
    <span class="n">mysocket</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="userstimeline.DateTimeEncoder.key_separator">
<code class="descname">key_separator</code><em class="property"> = ': '</em><a class="headerlink" href="#userstimeline.DateTimeEncoder.key_separator" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="userstimeline.UserTimelineAPI">
<em class="property">class </em><code class="descclassname">userstimeline.</code><code class="descname">UserTimelineAPI</code><span class="sig-paren">(</span><em>data_directory</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#UserTimelineAPI"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.UserTimelineAPI" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Class to fetch data of a specified list of users.</p>
<dl class="method">
<dt id="userstimeline.UserTimelineAPI.clear_everyting">
<code class="descname">clear_everyting</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#UserTimelineAPI.clear_everyting"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.UserTimelineAPI.clear_everyting" title="Permalink to this definition">¶</a></dt>
<dd><p>Clears the data folder</p>
</dd></dl>

<dl class="method">
<dt id="userstimeline.UserTimelineAPI.fetch_persist_friends_and_followers">
<code class="descname">fetch_persist_friends_and_followers</code><span class="sig-paren">(</span><em>user_screen_names</em>, <em>time</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#UserTimelineAPI.fetch_persist_friends_and_followers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.UserTimelineAPI.fetch_persist_friends_and_followers" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetches and persists users’ friends and followers</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>user_screen_names</strong> – list of screen names of users</li>
<li><strong>time</strong> – wall clock time when this file started running</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="userstimeline.UserTimelineAPI.fetch_persist_tweets">
<code class="descname">fetch_persist_tweets</code><span class="sig-paren">(</span><em>user_screen_names</em>, <em>time</em>, <em>type_</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#UserTimelineAPI.fetch_persist_tweets"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.UserTimelineAPI.fetch_persist_tweets" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetches and persists tweets (excluding tweets already persisted)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>user_screen_names</strong> – list of screen names of users</li>
<li><strong>time</strong> – wall clock time when this file started running</li>
<li><strong>type</strong> – one of ‘tweets’ or ‘favourites’ to fetch user’s own tweets or favorited tweets respectively</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="userstimeline.UserTimelineAPI.fetch_persist_users">
<code class="descname">fetch_persist_users</code><span class="sig-paren">(</span><em>user_screen_names</em>, <em>time</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#UserTimelineAPI.fetch_persist_users"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.UserTimelineAPI.fetch_persist_users" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetches and persists user information (calling this multiple times will keep adding new entries so that you can compare over time)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>user_screen_names</strong> – list of screen names of users</li>
<li><strong>time</strong> – wall clock time when this file started running</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="userstimeline.UserTimelineAPI.my_favourites_fetcher">
<code class="descname">my_favourites_fetcher</code><span class="sig-paren">(</span><em>retry_no=0</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#UserTimelineAPI.my_favourites_fetcher"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.UserTimelineAPI.my_favourites_fetcher" title="Permalink to this definition">¶</a></dt>
<dd><p>Waits until rate limit is clear and then calls the Twitter API to fetch user’s favorited tweets.
Retries 3 times in case of exceptions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>retry_no</strong> – Number of retries done till now in case of exceptions</li>
<li><strong>kwargs</strong> – Contains screen_name, count (maximum 200 allowed), since_id (minimum id of tweet to look for), max_id (maximum id of tweet to look for)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A list of tweet dictionaries</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="userstimeline.UserTimelineAPI.my_followers_fetcher">
<code class="descname">my_followers_fetcher</code><span class="sig-paren">(</span><em>retry_no=0</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#UserTimelineAPI.my_followers_fetcher"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.UserTimelineAPI.my_followers_fetcher" title="Permalink to this definition">¶</a></dt>
<dd><p>Waits until rate limit is clear and then calls the Twitter API to fetch user’s followers’ ids.
Retries 3 times in case of exceptions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>retry_no</strong> – Number of retries done till now in case of exceptions</li>
<li><strong>kwargs</strong> – Contains screen_name, cursor (used for paginated results, -1 to fetch the latest batch)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A dictionary containing ‘ids’ (ids of followers) and ‘next_cursor’ (cursor of next batch)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="userstimeline.UserTimelineAPI.my_friends_fetcher">
<code class="descname">my_friends_fetcher</code><span class="sig-paren">(</span><em>retry_no=0</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#UserTimelineAPI.my_friends_fetcher"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.UserTimelineAPI.my_friends_fetcher" title="Permalink to this definition">¶</a></dt>
<dd><p>Waits until rate limit is clear and then calls the Twitter API to fetch user’s friends’ ids.
Retries 3 times in case of exceptions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>retry_no</strong> – Number of retries done till now in case of exceptions</li>
<li><strong>kwargs</strong> – Contains screen_name, cursor (used for paginated results, -1 to fetch the latest batch)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A dictionary containing ‘ids’ (ids of friends) and ‘next_cursor’ (cursor of next batch)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="userstimeline.UserTimelineAPI.my_tweet_fetcher">
<code class="descname">my_tweet_fetcher</code><span class="sig-paren">(</span><em>retry_no=0</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#UserTimelineAPI.my_tweet_fetcher"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.UserTimelineAPI.my_tweet_fetcher" title="Permalink to this definition">¶</a></dt>
<dd><p>Waits until rate limit is clear and then calls the Twitter API to fetch user’s tweets.
Retries 3 times in case of exceptions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>retry_no</strong> – Number of retries done till now in case of exceptions</li>
<li><strong>kwargs</strong> – Contains screen_name, count (maximum 200 allowed), since_id (minimum id of tweet to look for), max_id (maximum id of tweet to look for)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A list of tweet dictionaries</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="userstimeline.UserTimelineAPI.my_user_fetcher">
<code class="descname">my_user_fetcher</code><span class="sig-paren">(</span><em>retry_no=0</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#UserTimelineAPI.my_user_fetcher"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.UserTimelineAPI.my_user_fetcher" title="Permalink to this definition">¶</a></dt>
<dd><p>Waits until rate limit is clear and then calls the Twitter API to fetch the given users’ info.
Retries 3 times in case of exceptions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>retry_no</strong> – Number of retries done till now in case of exceptions</li>
<li><strong>kwargs</strong> – Contains screen_name which is comma separated list of screen names</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A list of user info dictionaries</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="userstimeline.UserTimelineAPI.wait_for_rate_limit">
<code class="descname">wait_for_rate_limit</code><span class="sig-paren">(</span><em>type_</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#UserTimelineAPI.wait_for_rate_limit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.UserTimelineAPI.wait_for_rate_limit" title="Permalink to this definition">¶</a></dt>
<dd><p>Common function for all API calls that waits (sleeps) until the restriction of rate limiting for that type is clear.
For each request of each API call, it checks the corresponding array in COUNTS_DICT, deletes entries older than
WINDOW_LEN minutes and keeps checking the total no of requests in past WINDOW_LEN minutes until it is less
than the rate limit threshold set in COUNTS_LIMIT. Sleeps in between.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>type</strong> – The type of API call. One of ‘USERS_LOOKUP’, ‘TWEETS’, ‘FOLLOWERS’, ‘FRIENDS’, ‘FAVOURITES’.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="userstimeline.extract_hash_tags">
<code class="descclassname">userstimeline.</code><code class="descname">extract_hash_tags</code><span class="sig-paren">(</span><em>screen_name</em>, <em>date_start</em>, <em>date_end</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#extract_hash_tags"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.extract_hash_tags" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="userstimeline.get_user_screen_names">
<code class="descclassname">userstimeline.</code><code class="descname">get_user_screen_names</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#get_user_screen_names"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.get_user_screen_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="userstimeline.plot_user_field">
<code class="descclassname">userstimeline.</code><code class="descname">plot_user_field</code><span class="sig-paren">(</span><em>screen_name</em>, <em>date_start</em>, <em>date_end</em>, <em>field_names</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/userstimeline.html#plot_user_field"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#userstimeline.plot_user_field" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="stream-sample-api-code-documentation">
<h2>Stream Sample API Code Documentation<a class="headerlink" href="#stream-sample-api-code-documentation" title="Permalink to this headline">¶</a></h2>
<p>Here we provide a documentation of the code.</p>
<span class="target" id="module-streaming"></span><p>Module to stream 1% sample of tweets using Twitter’s Streaming API. The code will write the data in the same directory.</p>
<p>Create a file named SECRETS which contains your Twitter OAuth related keys in the following order, separated by new lines:
&lt;ACCESS_TOKEN&gt;
&lt;ACCESS_SECRET&gt;
&lt;CONSUMER_KEY&gt;
&lt;CONSUMER_SECRET&gt;</p>
<p><strong>Running the code</strong>:</p>
<blockquote>
<div><blockquote>
<div><ul>
<li><p class="first">First ensure Python Twitter Tools is installed. (<a class="reference external" href="https://github.com/sixohsix/twitter">https://github.com/sixohsix/twitter</a>)</p>
</li>
<li><p class="first">Before running, you may set the following parameters inside the file:</p>
<blockquote>
<div><ul class="simple">
<li>tweet_count = 1000000000 # total number of tweets to read</li>
<li>batch_size = 10000 # how many tweets to write together in 1 go</li>
<li>file_tweet_count = 500000 # max no of tweets to write in 1 file</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p><em>Command to run</em>:
<code class="docutils literal"><span class="pre">python</span> <span class="pre">streaming.py</span></code></p>
</div></blockquote>
<dl class="class">
<dt id="streaming.Logger">
<em class="property">class </em><code class="descclassname">streaming.</code><code class="descname">Logger</code><span class="sig-paren">(</span><em>batch_size</em>, <em>file_tweet_count</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/streaming.html#Logger"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#streaming.Logger" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Class to periodically write tweets to files and to log anything (automatically timestamped).
The function write_tweet will keep buffering tweets till batch_size is reached. Once the batch size
is reached, it flushes all the buffered tweets to the current tweet_file_name. Additionally, it keeps
track of number of tweets written to the current file and once it exceeds the threshold file_tweet_count,
it starts with a new tweet_file and starts flushing to it. This will prevent a single file from becoming
too big in size.</p>
<dl class="method">
<dt id="streaming.Logger.configure_new_file">
<code class="descname">configure_new_file</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/streaming.html#Logger.configure_new_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#streaming.Logger.configure_new_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Changes the configuration to start logging and writing tweets to new files (filenames will contain timestamp).
Also puts a ‘[‘ at the beginning of the tweet file to start a new list.</p>
</dd></dl>

<dl class="method">
<dt id="streaming.Logger.finish_current_file">
<code class="descname">finish_current_file</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/streaming.html#Logger.finish_current_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#streaming.Logger.finish_current_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Finshes the current tweet file by ending the list with a ‘]’.</p>
</dd></dl>

<dl class="method">
<dt id="streaming.Logger.log">
<code class="descname">log</code><span class="sig-paren">(</span><em>s</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/streaming.html#Logger.log"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#streaming.Logger.log" title="Permalink to this definition">¶</a></dt>
<dd><p>Logs the string supplied as argument to the current log file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>s</strong> – The string to log</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streaming.Logger.write_tweet">
<code class="descname">write_tweet</code><span class="sig-paren">(</span><em>tweet</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/streaming.html#Logger.write_tweet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#streaming.Logger.write_tweet" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds the tweet to the buffer. If buffer is filled, then flushes the buffer to the current tweet file.
If the current tweet file exceeds the tweet count threshold, finishes the current file and a configures a new one.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>tweet</strong> – The tweet to write to file</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="streaming.signal_handler">
<code class="descclassname">streaming.</code><code class="descname">signal_handler</code><span class="sig-paren">(</span><em>signal</em>, <em>frame</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/streaming.html#signal_handler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#streaming.signal_handler" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</div>


           </div><!-- /.toBeIndexed -->
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="kafka.html" class="btn btn-neutral float-right" title="Accesskey Alt(+Shift)+n" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduction.html" class="btn btn-neutral" title="Accesskey Alt(+Shift)+p" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="contentinfo">
      <p class="show_source">
        <a href="_sources/twitter_stream.rst.txt" rel="nofollow">
          <span class="fa fa-binoculars"></span>&#32;View page source
        </a>
      </p>
      <p class="show_copyright">
            &copy; Copyright 2018, Deepak Saini, Abhishek Gupta
      </p>
      <p class="show_sphinx">
        Built with <a href="http://sphinx-doc.org/" target="_blank">Sphinx</a> and
        <a href="https://github.com/TYPO3-Documentation/t3SphinxThemeRtd" target="_blank">t3SphinxThemeRtd.</a>
        Report theme issues <a href="https://github.com/TYPO3-Documentation/t3SphinxThemeRtd/issues" target="_blank">here.</a>
      </p>
      <p class="show_legalinfo">
        <a href="https://typo3.org/legal-info/" rel="nofollow">
          <span class="fa fa-legal"></span>&#32;Legal Info
        </a>
      </p>




  </div>

</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="_static/jquery-ui/jquery-ui.min.js"></script>
      <script type="text/javascript" src="_static/js/theme.js"></script>
      <script type="text/javascript" src="_static/js/t3autocomplete.js"></script>

  

  
   
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   <script type="text/javascript" id="idPiwikScriptPlaceholder"></script></body>
</html>