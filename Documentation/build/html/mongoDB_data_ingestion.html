<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Ingesting data into MongoDB &mdash; Twitter Analytics 0.1 documentation</title>
  

  
  

  

  

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/jquery-ui/jquery-ui.min.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/css/t3more.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Twitter Analytics 0.1 documentation" href="#"/>
        <link rel="next" title="Neo4j: API to generate cypher queries" href="neo4j_query_generation.html"/>
        <link rel="prev" title="Ingesting data into Neo4j" href="neo4j_data_ingestion.html"/> 
  <script src="_static/js/modernizr.min.js"></script>
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        <ul class="sidebartop">

          <li class="docsite">
            <a href="https://docs.typo3.org"><img src="_static/img/typo3-documentation.png" class="logo" /></a>
          </li>

          <li class="project">
            <a href="index.html">
              Twitter Analytics<br>0.1</a>
          </li><li class="nolink search">
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search this project" id="searchinput" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div></li>

        </ul>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to twitter analytics system</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#major-parts-of-the-system">Major parts of the system</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="twitter_stream.html">Read data from Twitter API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="twitter_stream.html#user-timeline-api">User Timeline API</a></li>
<li class="toctree-l2"><a class="reference internal" href="twitter_stream.html#stream-sample-api">Stream Sample API</a></li>
<li class="toctree-l2"><a class="reference internal" href="twitter_stream.html#user-timeline-api-code-documentation">User Timeline API Code Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="twitter_stream.html#stream-sample-api-code-documentation">Stream Sample API Code Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="neo4j_data_ingestion.html">Ingesting data into Neo4j</a><ul>
<li class="toctree-l2"><a class="reference internal" href="neo4j_data_ingestion.html#data-stored-in-neo4j">Data stored in neo4j</a><ul>
<li class="toctree-l3"><a class="reference internal" href="neo4j_data_ingestion.html#user-network">User network</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_data_ingestion.html#tweet-network">Tweet network</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_data_ingestion.html#indexing-network">Indexing network</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="neo4j_data_ingestion.html#ingesting-the-data-into-neo4j-logic">Ingesting the data into neo4j : Logic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="neo4j_data_ingestion.html#improving-ingestion-rate-using-transaction">Improving ingestion rate using transaction</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_data_ingestion.html#indexing">Indexing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="neo4j_data_ingestion.html#running-the-ingestion-script">Running the ingestion script</a></li>
<li class="toctree-l2"><a class="reference internal" href="neo4j_data_ingestion.html#neo4j-ingestion-rates">Neo4j Ingestion Rates</a></li>
<li class="toctree-l2"><a class="reference internal" href="neo4j_data_ingestion.html#code-documentation-for-neo4j-data-ingestion">Code Documentation for Neo4j data ingestion</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Ingesting data into MongoDB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-store-in-mongodb">Why store in MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-format-in-mongodb">Data Format in mongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mongodb-v-s-neo4j">mongoDB v/s neo4j</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ingesting-the-data-into-mongodb-logic">Ingesting the data into mongoDB : Logic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#improving-ingestion-rate-using-transactions">Improving ingestion rate using transactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#improving-ingestion-rate-using-parallel-multiple-process">Improving ingestion rate using parallel multiple process</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ingesting-the-data-into-mongodb-practical-side">Ingesting the data into mongoDB : Practical side</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mongodb-ingestion-rates">MongoDB Ingestion Rates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-ingest_raw">Code Documentation for mongoDB ingestion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="neo4j_query_generation.html">Neo4j: API to generate cypher queries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="neo4j_query_generation.html#template-of-a-general-query">Template of a general query</a><ul>
<li class="toctree-l3"><a class="reference internal" href="neo4j_query_generation.html#basic-abstraction">Basic Abstraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_query_generation.html#naming-entities">Naming entities</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_query_generation.html#variable-attributes">Variable attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="neo4j_query_generation.html#returns">Returns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="neo4j_query_generation.html#creating-a-custom-query-through-dashboard-api-behind-the-scenes">Creating a custom query through dashboard API : Behind the scenes</a></li>
<li class="toctree-l2"><a class="reference internal" href="neo4j_query_generation.html#code-documentation-for-neo4j-query-generation">Code Documentation for Neo4j query generation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mongoDB_query_generation.html">Generating queries in mongoDB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mongoDB_query_generation.html#generic-api-for-mongodb-idea">Generic API for mongoDB : Idea</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mongoDB_query_generation.html#mongodb-query-execution-code-documentation">MongoDB query execution code documentation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="postprocessing.html">About Post processing functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="postprocessing.html#need-of-post-processing-function">Need of post processing function</a></li>
<li class="toctree-l2"><a class="reference internal" href="postprocessing.html#format-of-post-processing-functions">Format of post processing functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="postprocessing.html#executing-post-processing-function">Executing post processing function</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dag.html">Composing multiple queries : DAG</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dag.html#basic-terminology">Basic terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag.html#idea-behind-a-dag">Idea behind a DAG</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag.html#building-a-dag-from-queries">Building a DAG from queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag.html#dag-in-airflow">DAG in airflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag.html#creating-custom-metric">Creating custom metric</a></li>
<li class="toctree-l2"><a class="reference internal" href="dag.html#code-documentation-for-dag-abstraction">Code Documentation for DAG abstraction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="flink.html">Generating alerts using Apache Flink and Kafka</a><ul>
<li class="toctree-l2"><a class="reference internal" href="flink.html#alert-specification-abstraction">Alert Specification Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="flink.html#back-end-process">Back-end process</a></li>
<li class="toctree-l2"><a class="reference internal" href="flink.html#example-finding-viral-hashtags">Example - Finding viral hashtags</a></li>
<li class="toctree-l2"><a class="reference internal" href="flink.html#flink-code-generator-documentation">Flink Code Generator Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="flink.html#flink-api-documentation">Flink API Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="benchmarking.html">Benchmarking the query answering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="benchmarking.html#neo4j-queries">Neo4j queries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="benchmarking.html#simple-queries">Simple Queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="benchmarking.html#complex-queries">Complex Queries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="benchmarking.html#mongodb-queries">MongoDB queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="benchmarking.html#code-documentation-for-benchmarking">Code Documentation for benchmarking</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dashboard_website.html">Dashboard Website</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dashboard_website.html#major-parts-of-the-dashboard-website">Major parts of the dashboard website</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#hashtags">Hashtags</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#mentions">Mentions</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#urls">URLs</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#alerts">Alerts</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#dag">DAG</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dashboard_website.html#use-cases">Use Cases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#viewing-top-10-popular-hashtags">Viewing top 10 popular hashtags</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#viewing-usage-history-of-hashtag">Viewing usage history of  hashtag</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#viewing-sentiment-history-of-hashtag">Viewing sentiment history of  hashtag</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#creating-a-mongodb-query">Creating a mongoDB query</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#creating-neo4j-queries">Creating neo4j queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#create-post-processing-function">Create Post processing function</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#view-queries">View Queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#create-dag">Create DAG</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#view-dags">View DAGs</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#create-custom-metric">Create Custom metric</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#create-alert">Create Alert</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard_website.html#view-alerts">View Alerts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Getting the system running</a><ul>
<li class="toctree-l2"><a class="reference internal" href="running.html#setting-up-the-environment">Setting up the environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#running-the-dashboard">Running the dashboard</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Twitter Analytics</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    <li>Ingesting data into MongoDB</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/mongoDB_data_ingestion.rst.txt" rel="nofollow">
                <span class="fa fa-binoculars"></span>&#32;View page source
            </a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody" class="toBeIndexed">
            
  <div class="section" id="ingesting-data-into-mongodb">
<h1>Ingesting data into MongoDB<a class="headerlink" href="#ingesting-data-into-mongodb" title="Permalink to this headline">¶</a></h1>
<div class="section" id="why-store-in-mongodb">
<h2>Why store in MongoDB<a class="headerlink" href="#why-store-in-mongodb" title="Permalink to this headline">¶</a></h2>
<p>In mongoDB we store only the data which can be extracted quickly from incoming tweets without much processing. We answer “non-network” based i.e. simple aggregate queries using MongoDB instead of Neo4j.</p>
<p>This means that any query which can be answered using mongoDB can also be answered using the network data in neo4j. This has been done to ensure that some very common queries can be answered quickly. Also, neo4j has a limit on the parallel sessions that can be made to the database, so in case we decide to do away with mongoDB, those queries would have to be answered from neo4j and would unnecessarily take up the sessions.</p>
</div>
<div class="section" id="data-format-in-mongodb">
<h2>Data Format in mongoDB<a class="headerlink" href="#data-format-in-mongodb" title="Permalink to this headline">¶</a></h2>
<p>We have three collections in mongoDB:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>To store the hashtags. Each document in this collection stores the following information:</dt>
<dd><ul class="first last">
<li>the hashtag</li>
<li>the timestamp of the tweet which contained the hashtag</li>
<li>the sentiment associated with the tweet containing the hashtag</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>To store urls</dt>
<dd><ul class="first last">
<li>the url</li>
<li>the timestamp of the tweet which contained the hashtag</li>
<li>the sentiment associated with the tweet containing the hashtag</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>To store user mentions</dt>
<dd><ul class="first last">
<li>the user mention</li>
<li>the timestamp of the tweet which contained the hashtag</li>
<li>the sentiment associated with the tweet containing the hashtag</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>Given this information in mongoDB, we can currently use it to answer queries like:</p>
<blockquote>
<div><ul class="simple">
<li>Most popular hashtags(and their sentiment) in total</li>
<li>Most popular hashtags(and their sentiment) in an interval of time</li>
<li>Most popular urls in total</li>
<li>Most popular urls in an interval of time</li>
<li>Most popular users in total(in terms of their mentions)</li>
<li>Most popular users in an interval of time(in terms of their mentions)</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="mongodb-v-s-neo4j">
<h2>mongoDB v/s neo4j<a class="headerlink" href="#mongodb-v-s-neo4j" title="Permalink to this headline">¶</a></h2>
<p>Note that just the bare minimum information that is currently being stored in the mongoDB. It can easily be extended to store more information. MongoDB provides strong mechanisms to aggregate and extract information
from the database.</p>
<p>So, even if we decide to store some pseudo-structural information, like the user of the tweet in hashtags collection and then answer queries like the sentiment associated will all the tweets of an user, we expect the query execution time to be atleast as fast as answering the query in neo4j, though in case of neo4j also, answering such query would also take only a single hop, which means that the execution time would be small anyways. This is precisely the reason why we don’t currently store such information in mongoDB.</p>
<p>But, as the size of the system grows, it would surely be beneficial to store much more condensed data in mongoDB and use it to answer more complex queries.</p>
</div>
<div class="section" id="ingesting-the-data-into-mongodb-logic">
<h2>Ingesting the data into mongoDB : Logic<a class="headerlink" href="#ingesting-the-data-into-mongodb-logic" title="Permalink to this headline">¶</a></h2>
<p>[scheme 1] A simple approach would be to ingest a tweet into the database as and when it comes in real time. But clearly(and as mentioned in mongoDB documentation) this is suboptimal, as we are connecting to the on-disk database frequently.</p>
<div class="section" id="improving-ingestion-rate-using-transactions">
<h3>Improving ingestion rate using transactions<a class="headerlink" href="#improving-ingestion-rate-using-transactions" title="Permalink to this headline">¶</a></h3>
<p>[scheme 2] An easy solution to this would be to keep collecting the data in memory and then write it to the database periodically in batches.</p>
<p>But observe that, the time it takes the process to open a connection to database and then write the data to it, no new tweets are being collected in memory.</p>
</div>
<div class="section" id="improving-ingestion-rate-using-parallel-multiple-process">
<h3>Improving ingestion rate using parallel multiple process<a class="headerlink" href="#improving-ingestion-rate-using-parallel-multiple-process" title="Permalink to this headline">¶</a></h3>
<p>[scheme 3] So finally we take the approach of utilizing multiple processes to write data to mongoDB.</p>
<p>Observe here the distinction between a thread and a process.
While using multiple threads, the threads are run(usually, if we discount the kernel threads spawned by python) on a single core in python, due to Global Interpreter Lock and thus, though we get virtual parallelism,
we don’t get real parallelism. Thus, due to the limitation of the language, we are using process to get the parallelism between writing to database and collecting new tweets.
A clear disadvantage of using process over threads will become clear below.</p>
<p>To explain the final multi-process approach, we have two processes running:</p>
<blockquote>
<div><ul class="simple">
<li>Accumulator process - It collects the tweets in an in-memory data structure. Also, in the beginning at t=0, it spawns a timer thread, which generates an interrupt after every pre-specified T time.</li>
<li>Connector process - It takes a list of tweets through a pipe, opens connection to the database and writes the tweets to the database.</li>
</ul>
</div></blockquote>
<p>How the system works can be understood through this image:</p>
<img alt="_images/mongo_ingestion.jpg" src="_images/mongo_ingestion.jpg" />
<p>So, the timer process in the accumulator process generates an interrupt after every T seconds, at this instant, the accumulator stops collecting tweets and writes those to Inter process communication(IPC) pipe. This is generally fast as IPC pipe are implemented in memory. Now, the other end of the pipe is in the connector process. After the writing process has been complete, it receives the tweets and starts writing those to the on-disk database as a batch, which again ensures that the process is faster as compared to writing single tweet at a time in a loop. Concurrently, while the connector process is writing the tweets, the accumulator process starts accumulating new tweets.</p>
<p>So in this way the the process of writing to database in connector process is overlapped with the the accumulation of tweets in accumulator process. Note that we have a small gap equivalent to time taken to write to IPC, in which the accumulator process is not collecting the tweets. The whole process can further be made efficient by removing this gap, but since we are getting tweet ingestion rate much more than the rate of tweets coming on twitter and the gain from removing the gap would not be much, we don’t implement it.</p>
<p>To answer queries like the most popular hashtags in total, or most popular hashtags in a large interval. It would be beneficial to have aggregates over a larger interval. For example, say we want to get the most popular hashtags in an year, it would be helpful in that setting to have an aggregated document containing 100 most popular hashtags in each month, then we can consider a union of these 12 documents plus some counting from the interval edges to get the most popular hashtags. Clearly, this will fasten the query answering rate. Though, this would not always give the exactly accurate results and can also not be used to get the counts of hashtags, but can be used to get most popular k hashtags as the size of data grows. To implement it, simply spawn another thread in the connector process to read data from the hashtags collection at a specific time interval(like 1 week), aggregate the data and store the aggregated information into a new collection. We provide the code for this, but don’t currently use this mechanism.</p>
</div>
</div>
<div class="section" id="ingesting-the-data-into-mongodb-practical-side">
<h2>Ingesting the data into mongoDB : Practical side<a class="headerlink" href="#ingesting-the-data-into-mongodb-practical-side" title="Permalink to this headline">¶</a></h2>
<p>On practical side, to ingest data into mongoDB, navigate to the Ingestion/MonogDB and make changes to the file ingest_raw.py. Specifically, provide the folder containing the tweets containing files. We are simulating the twitter stream by reading the tweets from a file on the disk and storing those in memory. This makes sense as we can’t possibly get tweets from the twitter hose at a rate greater than reading from memory, thus this in no way can be a bottleneck to the ingestion rate. Then just run the we need to run the file <cite>python ingest_raw.py</cite> to start ingesting. A logs file will be created which will keep on updating to help the user gauze the ingestion rate.</p>
<p>Please observe that the process of ingesting into neo4j and mongoDB are similar, with just variations in which code to run.</p>
</div>
<div class="section" id="mongodb-ingestion-rates">
<h2>MongoDB Ingestion Rates<a class="headerlink" href="#mongodb-ingestion-rates" title="Permalink to this headline">¶</a></h2>
<p>As expected, the ingestion rate into mongoDB while overlapping writing into database and accumulating data is faster than without parallelization. The plot below shows a comparison between scheme 2 and scheme 3 as described above. Observe that as more and more tweets are inserted, the difference between the two scheme grows as the time saved in overlapping inserting the accumulating keeps on adding up in advantage of scheme 3.</p>
<img alt="The mongoDB ingestion rate" src="_images/image1.png" />
<p>Clearly the ingestion rate depends on the time after which the interrupt to start write the collected tweets to database is generate(called T in <a class="reference internal" href="#improving-ingestion-rate-using-parallel-multiple-process"><span class="std std-ref">Improving ingestion rate using parallel multiple process</span></a>).</p>
<p>Finally we get an ingestion rate of around 7k-12k(around x10 of that of neo4j) tweets/second on average, depending on T.</p>
</div>
<div class="section" id="module-ingest_raw">
<span id="code-documentation-for-mongodb-ingestion"></span><h2>Code Documentation for mongoDB ingestion<a class="headerlink" href="#module-ingest_raw" title="Permalink to this headline">¶</a></h2>
<p>Module to ingest data into MongoDB. We try to overlay the collection and ingestion of tweets while ingeting data. For more details, see the documenation.</p>
<p>The <a class="reference internal" href="#module-ingest_raw" title="ingest_raw"><code class="xref py py-mod docutils literal"><span class="pre">ingest_raw</span></code></a> module contains the classes:</p>
<ul class="simple">
<li><a class="reference internal" href="#ingest_raw.Ingest" title="ingest_raw.Ingest"><code class="xref py py-class docutils literal"><span class="pre">ingest_raw.Ingest</span></code></a></li>
</ul>
<p>One can use the <a class="reference internal" href="#ingest_raw.Ingest.insert_tweet" title="ingest_raw.Ingest.insert_tweet"><code class="xref py py-func docutils literal"><span class="pre">ingest_raw.Ingest.insert_tweet()</span></code></a> to insert a new tweet into the database.</p>
<p>An example usage where we want to insert all tweets from all files in a folder tweet_folder:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">Ingest</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span><span class="o">.</span><span class="n">clear_db</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">read_tweets</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">tweet_folder</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="class">
<dt id="ingest_raw.Ingest">
<em class="property">class </em><code class="descclassname">ingest_raw.</code><code class="descname">Ingest</code><span class="sig-paren">(</span><em>interval</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_raw.html#Ingest"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_raw.Ingest" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Class to insert tweets into mongoDB.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>interval</strong> – time interval after which to generate interupt for starting ingestion of tweets</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="ingest_raw.Ingest.aggregate">
<code class="descname">aggregate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_raw.html#Ingest.aggregate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_raw.Ingest.aggregate" title="Permalink to this definition">¶</a></dt>
<dd><p>The function to be called in case, we choose to aggregate the counts at a larger inteeval.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">interval1&gt;&gt;interval. interval is like order of seconds and interal1 is like order of hours.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="ingest_raw.Ingest.clear_db">
<code class="descname">clear_db</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_raw.html#Ingest.clear_db"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_raw.Ingest.clear_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete all the collections</p>
</dd></dl>

<dl class="method">
<dt id="ingest_raw.Ingest.exit">
<code class="descname">exit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_raw.html#Ingest.exit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_raw.Ingest.exit" title="Permalink to this definition">¶</a></dt>
<dd><p>Join the worker process</p>
</dd></dl>

<dl class="method">
<dt id="ingest_raw.Ingest.insert_tweet">
<code class="descname">insert_tweet</code><span class="sig-paren">(</span><em>tweet</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_raw.html#Ingest.insert_tweet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_raw.Ingest.insert_tweet" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to collect incoming real time tweets. Update the in memory dictionaries.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>tweet</strong> – the json of the tweet.</td>
</tr>
</tbody>
</table>
<p>..note:: If we choose to keep new information about the tweets, we need to modify this, along with <a class="reference internal" href="#ingest_raw.Ingest.worker" title="ingest_raw.Ingest.worker"><code class="xref py py-func docutils literal"><span class="pre">ingest_raw.Ingest.worker()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="ingest_raw.Ingest.populate">
<code class="descname">populate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_raw.html#Ingest.populate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_raw.Ingest.populate" title="Permalink to this definition">¶</a></dt>
<dd><p>The code executed by the collector process. After each interupt it spawns a new timer thread to generate the
new interupt. Also, it puts the collected tweets into the IPC pipe and starts collecting new tweets.</p>
</dd></dl>

<dl class="method">
<dt id="ingest_raw.Ingest.worker">
<code class="descname">worker</code><span class="sig-paren">(</span><em>q</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_raw.html#Ingest.worker"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_raw.Ingest.worker" title="Permalink to this definition">¶</a></dt>
<dd><p>The function called inside he ingestor(worker) process. This function is alled after every &lt;interval&gt;
seconds. It loops to look for inputs from the pipe end. Once inputs are there, it opens connection to
database and commits the batch recieved from the pipe to the on-disk database.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>q</strong> – the inter-process communication pipe</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ingest_raw.Timer">
<em class="property">class </em><code class="descclassname">ingest_raw.</code><code class="descname">Timer</code><span class="sig-paren">(</span><em>interval</em>, <em>function</em>, <em>args=None</em>, <em>kwargs=None</em>, <em>iterations=1</em>, <em>infinite=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_raw.html#Timer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_raw.Timer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">multiprocessing.context.Process</span></code></p>
<p>Calls a function after a specified number of seconds:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="mf">30.0</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span> <span class="c1">#stops the timer if it is still waiting</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="ingest_raw.Timer.authkey">
<code class="descname">authkey</code><a class="headerlink" href="#ingest_raw.Timer.authkey" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="ingest_raw.Timer.cancel">
<code class="descname">cancel</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_raw.html#Timer.cancel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_raw.Timer.cancel" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop the timer if it hasn’t already finished.</p>
</dd></dl>

<dl class="attribute">
<dt id="ingest_raw.Timer.daemon">
<code class="descname">daemon</code><a class="headerlink" href="#ingest_raw.Timer.daemon" title="Permalink to this definition">¶</a></dt>
<dd><p>Return whether process is a daemon</p>
</dd></dl>

<dl class="attribute">
<dt id="ingest_raw.Timer.exitcode">
<code class="descname">exitcode</code><a class="headerlink" href="#ingest_raw.Timer.exitcode" title="Permalink to this definition">¶</a></dt>
<dd><p>Return exit code of process or <cite>None</cite> if it has yet to stop</p>
</dd></dl>

<dl class="attribute">
<dt id="ingest_raw.Timer.ident">
<code class="descname">ident</code><a class="headerlink" href="#ingest_raw.Timer.ident" title="Permalink to this definition">¶</a></dt>
<dd><p>Return identifier (PID) of process or <cite>None</cite> if it has yet to start</p>
</dd></dl>

<dl class="method">
<dt id="ingest_raw.Timer.is_alive">
<code class="descname">is_alive</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ingest_raw.Timer.is_alive" title="Permalink to this definition">¶</a></dt>
<dd><p>Return whether process is alive</p>
</dd></dl>

<dl class="method">
<dt id="ingest_raw.Timer.join">
<code class="descname">join</code><span class="sig-paren">(</span><em>timeout=None</em><span class="sig-paren">)</span><a class="headerlink" href="#ingest_raw.Timer.join" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait until child process terminates</p>
</dd></dl>

<dl class="attribute">
<dt id="ingest_raw.Timer.name">
<code class="descname">name</code><a class="headerlink" href="#ingest_raw.Timer.name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ingest_raw.Timer.pid">
<code class="descname">pid</code><a class="headerlink" href="#ingest_raw.Timer.pid" title="Permalink to this definition">¶</a></dt>
<dd><p>Return identifier (PID) of process or <cite>None</cite> if it has yet to start</p>
</dd></dl>

<dl class="method">
<dt id="ingest_raw.Timer.run">
<code class="descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_raw.html#Timer.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_raw.Timer.run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="ingest_raw.Timer.sentinel">
<code class="descname">sentinel</code><a class="headerlink" href="#ingest_raw.Timer.sentinel" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a file descriptor (Unix) or handle (Windows) suitable for
waiting for process termination.</p>
</dd></dl>

<dl class="method">
<dt id="ingest_raw.Timer.start">
<code class="descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ingest_raw.Timer.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start child process</p>
</dd></dl>

<dl class="method">
<dt id="ingest_raw.Timer.terminate">
<code class="descname">terminate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ingest_raw.Timer.terminate" title="Permalink to this definition">¶</a></dt>
<dd><p>Terminate process; sends SIGTERM signal or uses TerminateProcess()</p>
</dd></dl>

</dd></dl>

<dl class="attribute">
<dt id="ingest_raw.calculate_sentiment">
<code class="descclassname">ingest_raw.</code><code class="descname">calculate_sentiment</code><a class="reference internal" href="_modules/ingest_raw.html#calculate_sentiment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_raw.calculate_sentiment" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to calculate sentiment of a tweet. Just calculate the number of positive and negative words,
matching against a pre-curated list.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>positive_words</strong> – the list of positive sentiment words</li>
<li><strong>negative_words</strong> – the list of negative sentiment words</li>
<li><strong>tweet_text</strong> – the raw test of the tweet splitted tokenized, hashtags and user-mentions removed</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ingest_raw.getDateFromTimestamp">
<code class="descclassname">ingest_raw.</code><code class="descname">getDateFromTimestamp</code><span class="sig-paren">(</span><em>timestamp</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_raw.html#getDateFromTimestamp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_raw.getDateFromTimestamp" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="ingest_raw.read_tweets">
<code class="descclassname">ingest_raw.</code><code class="descname">read_tweets</code><span class="sig-paren">(</span><em>ingest</em>, <em>path</em>, <em>filename=''</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_raw.html#read_tweets"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_raw.read_tweets" title="Permalink to this definition">¶</a></dt>
<dd><p>Read tweets from the directory in path and inert all tweets in all files in the first level of path into
neo4j.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>path</strong> – the path of the directory</li>
<li><strong>twitter</strong> – a Twitter object</li>
<li><strong>filename</strong> – optional, if want to insert tweets from a single file</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ingest_raw.threaded">
<code class="descclassname">ingest_raw.</code><code class="descname">threaded</code><span class="sig-paren">(</span><em>fn</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ingest_raw.html#threaded"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ingest_raw.threaded" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</div>


           </div><!-- /.toBeIndexed -->
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="neo4j_query_generation.html" class="btn btn-neutral float-right" title="Accesskey Alt(+Shift)+n" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="neo4j_data_ingestion.html" class="btn btn-neutral" title="Accesskey Alt(+Shift)+p" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="contentinfo">
      <p class="show_source">
        <a href="_sources/mongoDB_data_ingestion.rst.txt" rel="nofollow">
          <span class="fa fa-binoculars"></span>&#32;View page source
        </a>
      </p>
      <p class="show_copyright">
            &copy; Copyright 2018, Deepak Saini, Abhishek Gupta
      </p>
      <p class="show_sphinx">
        Built with <a href="http://sphinx-doc.org/" target="_blank">Sphinx</a> and
        <a href="https://github.com/TYPO3-Documentation/t3SphinxThemeRtd" target="_blank">t3SphinxThemeRtd.</a>
        Report theme issues <a href="https://github.com/TYPO3-Documentation/t3SphinxThemeRtd/issues" target="_blank">here.</a>
      </p>
      <p class="show_legalinfo">
        <a href="https://typo3.org/legal-info/" rel="nofollow">
          <span class="fa fa-legal"></span>&#32;Legal Info
        </a>
      </p>




  </div>

</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="_static/jquery-ui/jquery-ui.min.js"></script>
      <script type="text/javascript" src="_static/js/theme.js"></script>
      <script type="text/javascript" src="_static/js/t3autocomplete.js"></script>

  

  
   
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   <script type="text/javascript" id="idPiwikScriptPlaceholder"></script></body>
</html>